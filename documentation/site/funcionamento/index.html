<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Como funciona - Ro-DOU - ferramenta de clipping dos diários oficiais</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Como funciona";
        var mkdocs_page_input_path = "funcionamento.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Ro-DOU - ferramenta de clipping dos diários oficiais
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Página Inicial</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../rodou/">O que é Ro-DOU?</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../utilizacao/">Como utilizar</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="#">Como funciona</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#compreendendo-melhor-a-pesquisa-no-diario-oficial-da-uniao">Compreendendo melhor a pesquisa no Diário Oficial da União</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#recursos-e-funcionalidades">Recursos e funcionalidades</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#parametros-de-pesquisa-disponiveis">Parâmetros de pesquisa disponíveis</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#exemplos-de-configuracao-do-arquivo-yaml">Exemplos de configuração do arquivo YAML</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#exemplo-1">Exemplo 1</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#exemplo-2">Exemplo 2</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#exemplo-3">Exemplo 3</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#exemplo-4">Exemplo 4</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#exemplo-5">Exemplo 5</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#exemplo-6">Exemplo 6</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#exemplo-7">Exemplo 7</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#exemplo-8">Exemplo 8</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#exemplo-9">Exemplo 9</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#exemplo-10">Exemplo 10</a>
    </li>
        </ul>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../contribuicoes/">Como contribuir</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../faq/">FAQ</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../midias/">Oficinas e mídias</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../links/">Links relevantes</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../contato/">Contato</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../changelog/">Changelog</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Ro-DOU - ferramenta de clipping dos diários oficiais</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Como funciona</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="como-funciona">Como funciona</h1>
<p>Nesta seção, você encontrará as seguintes informações sobre o Ro-DOU:</p>
<ul>
<li>Compreendendo melhor a pesquisa no Diário Oficial da União</li>
<li>Recursos e funcionalidades</li>
<li>Parâmetros de pesquisa disponíveis</li>
<li>Exemplos de configuração do arquivo YAML</li>
</ul>
<h2 id="compreendendo-melhor-a-pesquisa-no-diario-oficial-da-uniao">Compreendendo melhor a pesquisa no Diário Oficial da União</h2>
<p>Todos os parâmetros disponíveis para pesquisa no Diário Oficial da União (DOU) foram criados a partir da API da Imprensa Nacional, que por sua vez é utilizada pelo buscador oficial do DOU em <a href="https://www.in.gov.br/consulta/">https://www.in.gov.br/consulta/</a>.</p>
<p>Assim, é possível notar que o Ro-DOU consegue automatizar todo, ou quase todo, tipo de pesquisa que pode ser feita no site do Diário Oficial da União. A imagem abaixo é o painel de pesquisa avançada do site:</p>
<p><img alt="Captura de tela do painel de pesquisa avançada no site do DOU." src="https://github.com/gestaogovbr/Ro-dou/blob/main/docs/img/parametros-pesquisa-avancada-dou.png?raw=true" /></p>
<h2 id="recursos-e-funcionalidades">Recursos e funcionalidades</h2>
<p>O Ro-DOU possui os seguintes recursos e funcionalidades voltados aos usuários:</p>
<ul>
<li>Resultados com frequências <strong>diária</strong>, <strong>semanal</strong> ou <strong>mensal</strong>;</li>
<li>Relatórios em formato <code>.CSV</code> para facilitação do uso;</li>
<li>Busca dinâmica das palavras-chaves de um <strong>banco de dados</strong> ou de uma <strong>variável</strong>;</li>
<li>Pesquisa em <strong>seção</strong> específica do diário oficial;</li>
<li>Envio de notificações para os canais existentes no Discord e no Slack.</li>
</ul>
<h2 id="parametros-de-pesquisa-disponiveis">Parâmetros de pesquisa disponíveis</h2>
<p>A tabela abaixo resume os parâmetros de pesquisa disponíveis no Ro-DOU:</p>
<table>
<thead>
<tr>
<th style="text-align: left;"><strong>dou_sections</strong></th>
<th style="text-align: left;"><strong>date</strong></th>
<th style="text-align: left;"><strong>field</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">SECAO_1</td>
<td style="text-align: left;">DIA</td>
<td style="text-align: left;">TUDO</td>
</tr>
<tr>
<td style="text-align: left;">SECAO_2</td>
<td style="text-align: left;">SEMANA</td>
<td style="text-align: left;">TITULO</td>
</tr>
<tr>
<td style="text-align: left;">SECAO_3</td>
<td style="text-align: left;">MES</td>
<td style="text-align: left;">CONTEUDO</td>
</tr>
<tr>
<td style="text-align: left;">EDICAO_EXTRA</td>
<td style="text-align: left;">ANO</td>
<td style="text-align: left;">---</td>
</tr>
<tr>
<td style="text-align: left;">EDICAO_SUPLEMENTAR</td>
<td style="text-align: left;">---</td>
<td style="text-align: left;">---</td>
</tr>
<tr>
<td style="text-align: left;">TODOS</td>
<td style="text-align: left;">---</td>
<td style="text-align: left;">---</td>
</tr>
</tbody>
</table>
<p>Por padrão, caso omitido, o valor  do parâmetro <code>dou_sections</code> é TODOS. Nessa hipótese, a pesquisa é feita em todas as seções do Diário Oficial da União. Este campo aceita mais de uma opção.</p>
<h2 id="exemplos-de-configuracao-do-arquivo-yaml">Exemplos de configuração do arquivo YAML</h2>
<p>Neste segmento, você encontrará uma série de exemplos práticos de utilização do Ro-DOU. A leitura dos exemplos ajudará a visualizar de que maneira o Ro-DOU pode ser utilizado.</p>
<h3 id="exemplo-1">Exemplo 1</h3>
<p>A configuração a seguir cria uma DAG que realiza a pesquisa <strong>diária</strong> dos
<strong>6 termos listados</strong> e envia o relatório para o <strong>e-mail</strong> fornecido.</p>
<pre><code class="language-yaml">dag:
  id: pesquisa_dou_termos_interesse_nitai
  description: Pesquisa termos de interesse de Nitai.
  search:
    terms:
      - dados abertos
      - governo aberto
      - engenharia de dados
      - software livre
      - código aberto
      - open source
  report:
    emails:
      - nitaibezerra@protonmail.com
</code></pre>
<h3 id="exemplo-2">Exemplo 2</h3>
<p>A configuração a seguir realiza a pesquisa diária de <strong>segunda-feira a sexta-feira, 8AM</strong>, apenas na <strong>Seção 1 e na Edição Suplementar</strong> e envia o resultado em <strong>formato CSV</strong>, anexado ao e-mail. O parâmetro <code>schedule</code>
aceita valores CRON.</p>
<pre><code class="language-yaml">dag:
  id: dag_id_deve_ser_unico_em_todo_airflow
  description: DAG exemplo de monitoramento no DOU.
  schedule: 0 8 * * MON-FRI
  search:
    terms:
      - alocação
      - realoca
      - permuta
      - estrutura regimental
      - organização básica
    dou_sections:
      - SECAO_1
      - EDICAO_SUPLEMENTAR
  report:
    emails:
      - dest1@gestao.gov.br
      - dest2@gestao.gov.br
    attach_csv: True
    subject: Assunto do Email
</code></pre>
<p>Note que aqui são utilizados os parâmetros opcionais <code>schedule</code>,
<code>dou_section</code> e <code>attach_csv</code>.</p>
<h3 id="exemplo-3">Exemplo 3</h3>
<p>A configuração a seguir utiliza o parâmetro <code>from_db_select</code> em <code>terms</code>, que torna dinâmica a parametrização dos termos para pesquisa. Note também a inclusão de <code>tags</code> que ajudam na organização e na busca das DAGs no Airflow.</p>
<pre><code class="language-yaml">dag:
  id: dag_ultra_dinamica
  description: A pesquisa depende do select SQL.
  tags:
    - projeto_a
    - departamento_x
  search:
    terms:
      from_db_select:
        sql: SELECT text FROM schema.tabela;
        conn_id: airflow_conn_id
  report:
    emails:
      - email-destino@gestao.gov.br
    subject: &quot;[String] com caracteres especiais deve estar entre aspas&quot;
</code></pre>
<h3 id="exemplo-4">Exemplo 4</h3>
<p>A configuração a seguir utiliza o parâmetro <code>from_airflow_variable</code> em <code>terms</code>, que também carrega dinamicamente a lista de termos. Neste caso, há a recuperação a partir de uma <strong>variável do Airflow</strong>. Aqui, também é utilizado o campo <code>field</code> para limitar as pesquisas ao campo título das publicações no Diário Oficial da União.</p>
<pre><code class="language-yaml">dag:
  id: pesquisa_a_lista_na_variavel
  description: É fácil editar a variável na interface do Airflow.
  search:
    terms:
      from_airflow_variable: nome_da_variavel_no_airflow
    field: TITULO
  report:
    emails:
      - email-destino@gestao.gov.br
    skip_null: False
</code></pre>
<p>Caso não encontre nenhum resultado, será enviado um e-mail informando que
nenhum termo foi encontrado.</p>
<h3 id="exemplo-5">Exemplo 5</h3>
<p>A configuração a seguir produz uma DAG que executa apenas <strong>uma vez por mês</strong>, no dia 1 às 8 AM, como pode ser visto no <code>schedule</code>. Simultaneamente, a pesquisa no Diário Oficial da União é realizada nos diários oficiais do <strong>último mês</strong> inteiro, através do uso do parâmetro <code>date</code>. Aqui, também é utilizado o parâmetro <code>is_exact_search</code>
com valor <code>False</code> para utilizar uma pesquisa aproximada.</p>
<p>Apesar do fato de que o termo buscado "paralelpip<strong>i</strong>do" contenha um erro ortográfico, a busca retorna os resultados corretos. <a href="https://www.in.gov.br/consulta/-/buscar/dou?q=ddm__text__21040__texto_pt_BR-paralelepipido&amp;s=todos&amp;exactDate=ano&amp;sortType=0">Veja!</a></p>
<pre><code class="language-yaml">dag:
  id: relatorio_mensal_do_dou
  description: Envia um numero menor de emails.
  schedule: 0 8 1 * *
  search:
    terms:
      - paralelpipido
    date: MES
    is_exact_search: False
  report:
    emails:
      - email-destino@gestao.gov.br
</code></pre>
<h3 id="exemplo-6">Exemplo 6</h3>
<p>A configuração a seguir produz uma DAG que pesquisa no Querido Diário pelos termos "pandemia", "dados pessoais" e "prefeitura", buscando apenas os resultados do Diário Oficial de Belo Horizonte. Para conhecer o Querido Diário, acesse
<a href="https://queridodiario.ok.org.br/">https://queridodiario.ok.org.br/</a>.</p>
<pre><code class="language-yaml">dag:
  id: dou_qd_example
  description: DAG de teste
  search:
    sources:
    - QD
    territory_id: 3106200 # Belo Horizonte
    terms:
    - pandemia
    - dados pessoais
    - prefeitura
  report:
    emails:
      - destination@gestao.gov.br
    attach_csv: True
    subject: &quot;Teste do Ro-dou&quot;
</code></pre>
<h3 id="exemplo-7">Exemplo 7</h3>
<p>A configuração a seguir produz uma DAG exatamente igual ao exemplo básico, mas adiciona uma descrição longa do que a DAG faz, usando o parâmetro
<code>doc_md</code>. Essa descrição pode conter formatação markdown, incluindo
títulos, listas, links etc.</p>
<p>Além disso, acrescenta também uma referência ao nome do arquivo que
gerou a DAG, bem como os seus parâmetros.</p>
<pre><code class="language-yaml">dag:
  id: markdown_docs_example
  description: DAG com documentação em markdown
  search:
    terms:
    - dados abertos
    - governo aberto
    - lei de acesso à informação
  report:
    emails:
      - destination@gestao.gov.br
    subject: &quot;Teste do Ro-dou&quot;
  doc_md: &gt;-
    ## Ola!

    Esta é uma DAG de exemplo com documentação em markdown. Esta
    descrição é opcional e pode ser definida no parâmetro `doc_md`.

      * Ah, aqui você também pode usar *markdown* para
      * escrever listas, por exemplo,
      * ou colocar [links](graph)!
</code></pre>
<p>Para ver essa documentação, basta clicar o botão "DAG Docs" em qualquer
tela de visualização da DAG no Airflow.</p>
<p><img alt="Botão &quot;DAG Docs&quot;. Captura de tela da documentação de DAG no Airflow." src="https://github.com/gestaogovbr/Ro-dou/blob/main/docs/img/exemplo-dag-doc_md.png?raw=true" /></p>
<h3 id="exemplo-8">Exemplo 8</h3>
<p>Esta configuração envia as notificações para canais Discord. É necessário ter
permissões de administrador no Discord para gerar o Webhook:</p>
<pre><code class="language-yaml">dag:
  id: discord_example
  description: Envia notificações para canal Discord
  search:
    terms:
    - manifestação cultural
    - expressão cultural
    - política cultural
  report:
    report:
    discord:
      webhook: https://discord.com/api/webhooks/105220xxxxxx811250/Q-XsfdnoHtudTQ-8A6zzzzznitai-vi0bGLE7xxxxxxxxxxxxxxxxxxxmx94R3oZ1h0ngl1
</code></pre>
<h3 id="exemplo-9">Exemplo 9</h3>
<p>Esta configuração envia as notificações para canais Slack. É necessário ter
permissões de administrador no Slack para gerar o Webhook:</p>
<pre><code class="language-yaml">dag:
  id: slack_example
  description: Envia notificações para canal Slack
  search:
    terms:
    - manifestação cultural
    - expressão cultural
    - política cultural
  report:
    report:
    slack:
      webhook: https://hooks.slack.com/services/XXXXXXXX/XXXXNFDXXX/n6QXXXXrPwxQ71ZXXXXXT9
</code></pre>
<h3 id="exemplo-10">Exemplo 10</h3>
<p>Esta configuração filtra os resultados por órgão/unidade selecionados.
Por enquanto disponível apenas para as pesquisas no DOU.</p>
<pre><code class="language-yaml">dag:
  id: department_example
  description: DAG de teste (filtro por departamento)
  search:
    terms:
      - dados abertos
    department:
      - Ministério da Gestão e da Inovação em Serviços Públicos
      - Ministério da Defesa
  report:
    emails:
      - destination@gestao.gov.br
    subject: &quot;Teste do Ro-dou&quot;
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../utilizacao/" class="btn btn-neutral float-left" title="Como utilizar"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../contribuicoes/" class="btn btn-neutral float-right" title="Como contribuir">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../utilizacao/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../contribuicoes/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
